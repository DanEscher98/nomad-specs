// NOMAD Protocol v1.0.0 Test Vectors
// Generated by specs/generate_vectors.py
// DO NOT EDIT - regenerate with: python specs/generate_vectors.py
//
// These vectors are the SOURCE OF TRUTH for all implementations.
// If your implementation doesn't match these values, your implementation is wrong.

{
  "_metadata": {
    "description": "Sync layer test vectors for NOMAD v1.0",
    "generated": "2025-12-26T08:56:36.332722Z",
    "generator": "specs/generate_vectors.py",
    "protocol_version": "1.0.0"
  },
  "_notes": [
    "All integers are little-endian",
    "Sync message header: sender(8) + acked(8) + base(8) + diff_len(4) = 28 bytes",
    "Diff payload is application-defined, here we use simple ASCII for testing"
  ],
  "sync_messages": [
    {
      "name": "initial_state",
      "description": "First sync message from initiator (state 1, acking nothing)",
      "sender_state_num": 1,
      "acked_state_num": 0,
      "base_state_num": 0,
      "diff": {
        "ascii": "initial state",
        "hex": "696e697469616c207374617465"
      },
      "diff_length": 13,
      "encoded": "0100000000000000000000000000000000000000000000000d000000696e697469616c207374617465",
      "encoded_length": 41
    },
    {
      "name": "normal_sync",
      "description": "Normal sync with state update and ack",
      "sender_state_num": 5,
      "acked_state_num": 3,
      "base_state_num": 4,
      "diff": {
        "ascii": "state delta",
        "hex": "73746174652064656c7461"
      },
      "diff_length": 11,
      "encoded": "0500000000000000030000000000000004000000000000000b00000073746174652064656c7461",
      "encoded_length": 39
    },
    {
      "name": "ack_only",
      "description": "Ack-only message (no state change, empty diff)",
      "sender_state_num": 10,
      "acked_state_num": 10,
      "base_state_num": 0,
      "diff": {
        "ascii": "",
        "hex": ""
      },
      "diff_length": 0,
      "encoded": "0a000000000000000a00000000000000000000000000000000000000",
      "encoded_length": 28
    },
    {
      "name": "large_version_numbers",
      "description": "Large version numbers (near max uint64)",
      "sender_state_num": 281474976710655,
      "acked_state_num": 281474976710654,
      "base_state_num": 281474976710653,
      "diff": {
        "ascii": "big",
        "hex": "626967"
      },
      "diff_length": 3,
      "encoded": "ffffffffffff0000feffffffffff0000fdffffffffff000003000000626967",
      "encoded_length": 31
    },
    {
      "name": "binary_diff",
      "description": "Sync with binary diff payload (not ASCII)",
      "sender_state_num": 100,
      "acked_state_num": 99,
      "base_state_num": 99,
      "diff": {
        "hex": "deadbeef00112233"
      },
      "diff_length": 8,
      "encoded": "64000000000000006300000000000000630000000000000008000000deadbeef00112233",
      "encoded_length": 36
    },
    {
      "name": "empty_initial",
      "description": "Empty initial state (all zeros except sender=1)",
      "sender_state_num": 1,
      "acked_state_num": 0,
      "base_state_num": 0,
      "diff": {
        "ascii": "",
        "hex": ""
      },
      "diff_length": 0,
      "encoded": "01000000000000000000000000000000000000000000000000000000",
      "encoded_length": 28
    },
    {
      "name": "retransmit_scenario",
      "description": "Retransmit of state 5 (ack moved forward)",
      "sender_state_num": 5,
      "acked_state_num": 7,
      "base_state_num": 4,
      "diff": {
        "ascii": "retransmit",
        "hex": "72657472616e736d6974"
      },
      "diff_length": 10,
      "encoded": "0500000000000000070000000000000004000000000000000a00000072657472616e736d6974",
      "encoded_length": 38
    }
  ],
  "convergence_scenarios": [
    {
      "name": "normal_convergence",
      "description": "Normal sync convergence between two peers",
      "messages": [
        {
          "direction": "A->B",
          "sender_state_num": 1,
          "acked_state_num": 0,
          "base_state_num": 0,
          "diff_ascii": "hello",
          "encoded": "0100000000000000000000000000000000000000000000000500000068656c6c6f"
        },
        {
          "direction": "B->A",
          "sender_state_num": 1,
          "acked_state_num": 1,
          "base_state_num": 0,
          "diff_ascii": "world",
          "encoded": "01000000000000000100000000000000000000000000000005000000776f726c64"
        },
        {
          "direction": "A->B",
          "sender_state_num": 2,
          "acked_state_num": 1,
          "base_state_num": 1,
          "diff_ascii": "update1",
          "encoded": "0200000000000000010000000000000001000000000000000700000075706461746531"
        },
        {
          "direction": "B->A",
          "sender_state_num": 2,
          "acked_state_num": 2,
          "base_state_num": 1,
          "diff_ascii": "update2",
          "encoded": "0200000000000000020000000000000001000000000000000700000075706461746532"
        }
      ]
    },
    {
      "name": "packet_loss_recovery",
      "description": "Recovery from lost packets (idempotent diffs)",
      "messages": [
        {
          "direction": "A->B",
          "sender_state_num": 1,
          "acked_state_num": 0,
          "base_state_num": 0,
          "diff_ascii": "msg1",
          "status": "delivered",
          "encoded": "010000000000000000000000000000000000000000000000040000006d736731"
        },
        {
          "direction": "A->B",
          "sender_state_num": 2,
          "acked_state_num": 0,
          "base_state_num": 1,
          "diff_ascii": "msg2",
          "status": "LOST",
          "encoded": "020000000000000000000000000000000100000000000000040000006d736732"
        },
        {
          "direction": "A->B",
          "sender_state_num": 3,
          "acked_state_num": 0,
          "base_state_num": 2,
          "diff_ascii": "msg3",
          "status": "delivered",
          "encoded": "030000000000000000000000000000000200000000000000040000006d736733"
        },
        {
          "direction": "B->A",
          "sender_state_num": 1,
          "acked_state_num": 3,
          "base_state_num": 0,
          "diff_ascii": "ack",
          "status": "delivered",
          "encoded": "0100000000000000030000000000000000000000000000000300000061636b"
        },
        {
          "direction": "A->B",
          "sender_state_num": 3,
          "acked_state_num": 1,
          "base_state_num": 2,
          "diff_ascii": "msg3",
          "status": "retransmit",
          "encoded": "030000000000000001000000000000000200000000000000040000006d736733"
        }
      ],
      "notes": [
        "Message 2 is lost in transit",
        "Peer retransmits and receiver handles idempotently"
      ]
    }
  ]
}
